## InnoDB 버퍼풀

InnoDB 엔진이 Table Caching 및 Index Data Caching을 위해 이용하는 메모리 공간이다.

버퍼 풀은 디스크에 읽은 상태로 전혀 변경되지 않은 클린 페이지와 변경된 데이터를 가진 더티 페이지를 가지고 있다.

실제 DB에서 Commit이 발생하면 바로 디스크 영역(Table Space)으로 들어가는 것이 아닌 메모리 영역(Buffer Poll & Log Buffer)에 들어가는 것을 확인할 수 있다.(DISK I/O 절약)

하지만 장애가 발생시 Buffer Pool 내용은 ACID를 보장 할수 없어 복구할수 없는 데이터이다.

## **Redo Log**

Log Buffer는 메모리 영역, 메모리 영역이라는 것은 용량이 제한적이다.  용량이 제한적이기 때문에 Checkpoint 이벤트 발생시점에 Redo Log Buffer에 있던 데이터들을 Disk에 File로 저장하게 된다. 이 파일을 **Redo Log File**라고 부릅니다.

이 Redo Log File을 가지고 데이터를 복구 할 수 있다.

## Undolog

InnoDB 스토리지 엔진은 트랜잭션과 격리 수준을 보장하기 위해 변경 이전의 데이터를 별도로 백업한다. 이렇게 백업된 데이터가 Undo log이다.

- 트랜잭션 보장 : 트랜잭션이 롤백되면 언두 로그에 백업 해둔 이전 버전의 데이터를 이용해 복구
- 격리 수준 보장 : 특정 커넥션에서 데이터를 변경하는 도중에 다른 커넥션에서 데이터를 조회하면 트랜잭션 격리 수준에 맞게 변경 중인 레코드를 읽지 않고 언두 로그에 백업해둔 데이터를 읽어서 반환하기도 한다

## 정리

- Redo 로그 (변경 후의 값을 기록)
- Undo 로그 (변경 전의 값을 기록)

## 트렌젝션

트랜잭션은 작업의 완전성을 보장해 주는 것이다. 즉 논리적인 작업 셋을 모두 완벽하게 처리하거나, 처리하지 못할 경우에는 원 상태로 복구해서 작업의 일부만 적용되는 현상(Partial update)이 발생하 지 않게 만들어주는 기능이다.

**잠금(Lock)**: 잠금은 여러 커넥션에서 동시에 동일한 자원(레코드, 테이블)을 요청할 경우 한 시점에는 하나의 커넥션만 해당 자원을 변경할 수 있게 해주는 역할을 한다. 데이터 정합성을 위한 트랜잭션과는 달리 동시성 제어를 위한 기능이다.

## 락과의 차이점

트렌젝션이란 결국 일련의 연산을 하나의 논리적 작업으로 정의하는 행위이고 특정 논리적 작업을 수행하는 과정에서 커밋, 하거나 롤백하는 개념이 핵심이다.

하지만 트랜잭셕만 진행 된다하여 동시성 문제가 해결되는 것은 아니다.

동시성을 보장하기 위해 트랜잭션의 격리 수준을 어디까지 설정할 것인가에 따라 달라진다. (ACID 의 격리성 Isolation)

ex) 트랜잭션의 격리수준 **Read Uncommitted, Read Committed, Repeatable Read, Serializable Read**

레벨(고립도)이 높아질수록 고립도가 올라가서 더 확실한 처리가 가능해지지만 동시에 수행될 수 있는 트랜잭션을 순서대로 처리하게 되어 속도가 느려지게 된다.

개발자는 트랜잭션의 격리수준과, 성능에서 기술적 의사결정을 해야한다.

트랜잭션을 걸면 무조건 동시성이 보장된다. 이 말은  항상 맞는 말이 아니다.  격리성을 어느정도 까지 유지하며 동시성을 체크 할 것인지는 트랜잭션의 격리성을 보장하기위해 어떤 락을 걸 것인지가 중요하다.

### **낮은 단계의 트랜잭션 격리 수준을 사용할 때 발생하는 현상**

## Dirty Read

다른 트랜잭션에 의해 수정됐지만 아직 커밋되지 않은 데이터를 읽는 것을 말한다.

## Non-Repeatable Read

한 트랜잭션 내에서 같은 쿼리를 두 번 수행했을때, 두 쿼리의 결과가 상이하게 나타나는 비일관성 현상이다.

한 트랜잭션이 수행 중 일때 다른 트랜잭션이 값을 수정 또는 삭제하면 발생한다.

## Phantom Read

## 트랜잭션 주의사항

MyISAM은 트랜잭션을 지원하지 않는다.

프로그램 코드에서 트랜잭션의 범위를 최소화 해야한다.

- 데이터베이트의 커넥션 개수는 제한 점이므로, 각 단위 프로그램이 커넥션을 소유하는 시간이 길어질 수록 사용가능한 커넥션의 개수는 줄어든다.
- 네트워크를 통해 원격 서버와 통신하는 등과 같은 작업은 DBMS에 트랜잭션 내에서 제거하는 것이 좋다. 네트워크 에러가 웹 서버 뿐 아니라 DBMS 서버에 영향을 미칠 수 있다.
- 단순 조회에 대해서는 트랜잭션에 포함할 필요는 없다.

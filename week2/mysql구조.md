![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/457ada5b-3b23-46f5-8ad2-56cb61abe80e/cdf4f224-39f0-4bfb-afa0-e9cdadde150a/Untitled.png)

## mysql 전체적인 구조

- mysql 엔진

MySQL 엔진은 클라이언트로부터의 접속 및 쿼리 요청을 처리하는 **커넥션 핸들러**와 **SQL 파서** 및 **전 처리기**. 쿼리의 최적화된 실행을 위한 **옵티마이저**가 중심을 이룬다

- 스토리지 엔진

MySQL 엔진은 요청된 SQL 문장을 분석하거나 최적화하는 등 DBMS의 두뇌에 해당하는 처리를 수행 하고, 실제 데이터를 디스크 스토리지에 저장하거나 디스크 스토리지로부터 데이터를 읽어오는 부분은 스토리지 엔진이 전담한다

MySQL 서버에서 MySQL 엔진은 하나지만 스토리지 엔진은 여러 개를 동 시에 사용할 수 있다

흔히 말하는 myisam, innodb

- 위 두가지를 통틀어 mysql 서버라고함

## MySQL 스레딩 구조

- mysql 엔진은 하나지만 스토리 엔진은 여러개 쓸수있따
- 사용자 스레드 = 포그라운드 스레드

포그라운드 스레드가 mysql 버퍼, 캐시에 데이터 요청 없으면 직접 디스크에 요청

mysql 메모리영역

1. 글로벌영역
2. 로컬영역 클라이언트 스레드가 쿼리를 처리하는데 사용하는 메모리영역

## 플러그인 스토리지 엔진 모델

MySQL의 독특한 구조 중 하나는 플러그인 모델이다.

MySQL은 이미 기본적으로 많은 스토리지 엔진을 가지고 있다. 

사용자의 조건에 따라 직접 스토리지 엔진을 개발하는 것도 가능하다.

MySQL 서버에서 MySQL 엔진은 사람 역할을 하고 각 스토리지 엔진은 자동차 역할을 하는데, MySQL 엔진이 스토리지 엔진을 조정하기 위해 핸들러라는 것을 사용하게 된다

**MySQL 엔진이 각 스토리지 엔진에게 데이터를 읽어오거나 저장하도록 명령하려면 반드시 핸들러를 통해야 한다는 점을 기억하자**

## 컴포넌트

MySQL 서버의 플러그인은 다음과 같은 몇 가지 단점이 있는데, 컴포넌트는 이러한 단점들을 보완해

MySQL 서버 플러그인 단점

- 플러그인은 오직 MySQL 서버와 인터페이스할 수 있고, 플러그인끼리는 통신할 수 없음
- 플러그인은 MySQL 서버의 변수나 함수를 직접 호출하기 때문에 안전하지 않음（캡슐화 안 됨）
- 플러그인은 상호 의존 관계를 설정할 수 없어서 초기화가 어려움

## 쿼리 실행 구조

### 쿼리 파서

사용자 요청으로 들어온 쿼리 문장을 토큰（MySQL이 인식할 수 있는 최소 단위의 어휘나
기호）으로 분리해 트리 형태의 구조로 만들어 내는 작업을 의미한다.

### 전처리기

파서 과정에서 만들어진 파서 트리를 기반으로 쿼리 문장의 문제점을 확인한다.

각 토큰을 테이블 이름, 컬럼 이름, 또는 내장 함수와 같은 개체를 매핑해 객체의 존재 여부와 접근 권한 등을 확인하는 과정을 수행한다.

### 옵티마이저

**옵티마이저란 사용자의 요청으로 들어온 쿼리 문장을 저렴한 비용으로 가장 빠르게 처리할지를 결정하는 역할을 담당하며, DBMS의 두뇌에 해당한다고 볼 수 있다. 가장 중요하다**

### 실행 엔진

옵티마이저가 두뇌라면 실행 엔진과 핸들러는 손과 발에 비유할 수 있다.

### 핸들러（스토리지 엔진）

MySQL 실행 엔진의 요청에 따라 데이터를 디스크에 저장하고 읽어오는 역할을 담당한다.

핸들러는 곧 스토리지 엔진을 의미한다.

## 쿼리 캐시

MySQL 8.0으로 올라오면서 쿼리 캐시는 MySQL 서버의 기능에서 완전히 제거되고, 관련된 시 스템 변수도 모두 제거됐다

## 스레드 풀

## 트랜잭션 지원 메타데이터

MySQL 8.0 버전부터 데이터 딕셔너리와 시스템 테이블이 모두 트랜잭션 기반의 InnoDB 스토리지 엔진에 저장되도록 개선되면서 이제 스키마 변경 작업 중간에 MySQL 서버가 비정상적으로 종료된다 고 하더라도 스키마 변경이 완전한 성공 또는 완전한 실패로 정리된다.

# Mysql로그파일

로그 파일을 이용하면 MySQL 서버의 깊은 내부 지식이 없이도 MySQL의 상태나 부하를 일으키는 원인을 쉽게 찾아 해결할 수 있다.

## 에러 로그파일

MySQL이 실행되는 도중에 발생하는 에러나 경고 메시지가 출력되는 로그 파일.

위치는 MySQL 설정 파일(my.cnf)에서 log_error라는 파라미터 경로에 생성

## 제너럴 쿼리 파일

쿼리 로그 파일의 경로는 제너럴 로그 파일이란 파라미터에 설정돼 있다. 

이 로그 파일을 검토해 MySQL 서버에서 실행되는 쿼리에는 어떤 것들이 있는지 검토할 수 있다.

## 슬로워 커리 로그

MySQL 서버의 쿼리 중 정기적인 점검을 위한 튜닝에서 어떤 쿼리가 문제의 쿼리인지 판단하기는 어려운데, 이때 슬로우 쿼리 로그가 도움이 된다.

long_query_time 시스템 변수에 설정된 시간 이상이 소요된 쿼리가 모두 기록된다. 즉, 슬로우 쿼리 로그 파일에 기록된 쿼리는 long_query_time 보다 시간이 오래 걸린 정상적인 쿼리이다.
